<!DOCTYPE html>
<html>

<head>
	<meta charset=utf-8 />
	<title>Food Desert Map</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<link rel='icon' href='https://newmapsplus.github.io/favicon.ico' type='image/x-icon' />

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
		integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
		crossorigin="" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

	<link href="https://fonts.googleapis.com/css?family=Quicksand:400,700" rel="stylesheet">

	<style>
		body {
			margin: 0;
			padding: 0;
			font-family: 'Quicksand', sans-serif;
			font-size: 100%;
			color: #3d3d3d;
		}

		h1 {
			position: absolute;
			margin-top: 0;
			top: 10px;
			left: 15px;
			font-size: 1.5em;
			font-family: 'Quicksand', sans-serif;
			font-weight: 700;
			letter-spacing: .04em;
			padding: 10px 15px;
			/* Add styles to match Leaflet UI elements */
			background: rgba(256, 256, 256, .3);
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
			border: 1px solid #ddd;
			border-radius: 5px;
			z-index: 800;
		}

		h2 {
			font-family: 'Quicksand', sans-serif;
			font-size: 1.2em;
			letter-spacing: .04em;

		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		#about {
			position: absolute;
			bottom: 20px;
			left: 15px;
			width: 280px;
			padding: 0 15px;
			/* Add styles to match Leaflet UI elements */
			background: rgba(256, 256, 256, .3);
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
			border: 1px solid #ddd;
			border-radius: 5px;
			z-index: 800;
		}

		p {
			font-size: .9em;
			line-height: 1.5em;
		}

		a {
			color: #005daa;
			text-decoration: none;
		}

		a:hover {
			text-decoration: underline;
		}

		/* Leaflet popup styles */
		.leaflet-popup-content {
			font-family: 'Quicksand', sans-serif;
			font-size: 1.1em;
		}

		/* 
		When browser is 900px high or less
		make the font a little smaller.
		 */
		@media screen and (max-height: 400px) {

			#about p,
			#about h2 {
				font-size: .6em;
			}

			h1 {
				font-size: 1.2em;
			}

			#about h2 {
				font-size: 1em;
			}

			.leaflet-popup-content {
				font-family: 'Quicksand', sans-serif;
				font-size: 0.9em;
			}
		}

		/* Don't display info block when window is very small */
		@media screen and (max-height: 200px) {

			#about {
				display: none;
			}
		}
	</style>
</head>

<body>

	<h1>2015 United States Food Desert Map</h1>

	<div id='map'></div>

	<section id="about">
		<h2>About this</h2>
		<p>Additional information about <a href="#">the data</a> and map goes here. Lorem ipsum dolor sit amet,
			consectetur adipiscing elit. Duis urna magna, maximus nec laoreet sit amet, dictum ultricies nibh. Ut id
			auctor lacus. Nam a dolor et justo luctus luctus. </p>
		<p>Map authored by Joyia Williams</p>
	</section>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
		integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
		crossorigin=""></script>
	<!-- Load a Leaflet plugin to provide geolocation. -->
	<script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js"
        charset="utf-8"></script>
     <!-- add jQuery JS script -->
	<script>
	fetch('data/DataD15.json')
	// fetching Census Data
	.then(function (response) {
		console.log(response)
if (response.ok) {
		return response.json()
	}
	 else {
		throw new Error(`HTTP error! status: ${response.status}`);
	}
	})
	// try .then method
	.then(function (data) {
		// Draw map from Data
		var dataLayer = L.geoJson(data, {
      style: function (feature) {
        return {
          color: 'white',
          weight: 1,
          fillOpacity: 1,
          fillColor: '#1f78b4'
        };
      }
    }).addTo(map)
    // Make call to update map
    drawMap(dataLayer);
	})
	var options = {
    center: [37.8, -85.8],
    zoom: 7.4,
    zoomSnap: .1,
    zoomControl: false
}
var map = L.map('map', options);
$.getJSON("Data/DataD15.json", function(data) {
L.geoJson(data, {
  style: function(feature) {
    return {
      color: '#dddddd',
      weight: 1,
      fillOpacity: 1,
      fillColor: '#1f78b4'
    };
  }
}).addTo(map)
L.geoJson(data).addTo(map);
});

map.addControl( L.control.zoom({ position: 'topright' }));
// data paramter is not accessible here! (fixed)

var attributeValue = "CENSUSTRACT" ,
normValue = "STATE";
// Make the call to external data
fetch('data/DataD15.json')
  // When the server responds, let's evaluate the response
  .then(function (response) {
    // Look at the response
    console.log(response)
    // The API call was successful!
    if (response.ok) {
        // Parse the response as a JSON and return it
        return response.json() 
    } else { 
        // Present the numeric status code if it fails. 
        throw new Error(`HTTP error! status: ${response.status}`);
    }
  })
  // Pass the returned value of previous .then() method as 'data'
  .then(function (data) {
    // Draw basic map from data
    var dataLayer = L.geoJson(data, {
      style: function (feature) {
        return {
          color: 'white',
          weight: 1,
          fillOpacity: 1,
          fillColor: '#1f78b4'
        };
      }
    }).addTo(map)
    // Make call to update map
    drawMap(dataLayer);
  })

  .then(function () {
    // Draw another layer after the previous .then() resolves
    drawAnotherLayer()
  })
  
  // Define a function that fetches data and then draws another layer
  function drawAnotherLayer() {
    fetch("data/us_states_500k.geojson").then(function (response) {
      if (response.ok) {
        // Parse the response as a JSON and return it
        return response.json() 
      }
    })
    .then(function(data) {
      L.geoJson(data,{
        style: function (feature) {
          return {
            color: '#444',
            weight: 2,
            fillOpacity: 0,
            interactive: false
          };
        }
      }).addTo(map)
    })
  }

function drawMap (dataLayer) {
var breaks = getClassBreaks(dataLayer);
dataLayer.eachLayer(function(layer) {
var props = layer.feature.properties;
layer.setStyle({
  fillColor: getColor(props[attributeValue]/props[normValue], breaks)
});
});
function getColor(d, breaks) {

  if(d <= breaks[0][1]) {
    return '#f1eef6';
  } else if(d <= breaks[1][1]) {
    return '#bdc9e1';
  } else if(d <= breaks[2][1]) {
    return '#74a9cf';
  } else if(d <= breaks[3][1]) {
    return '#2b8cbe'
  } else if(d <= breaks[4][1]) {
    return '#045a8d'
  }
} // end getColor
function drawLegend(breaks){

// create a new Leaflet control object, and position it top left
var legend = L.control({position: 'topleft'});

// when the legend is added to the map
legend.onAdd = function () {

    // create a new HTML <div> element and give it a class name of "legend"
    var div = L.DomUtil.create('div', 'legend');

    // first append an <h3> tag to the div holding the current attribute
    // and norm values (i.e., the mapped phenomena)
    div.innerHTML = `<h3>${attribute} per  ${norm}</h3>`;

    // for each of our breaks
    for (var i = 0; i < breaks.length; i++) {
        // determine the color associated with each break value,
        // including the lower range value
        var color = getColor(breaks[i][0], breaks);

        // concatenate a <span> tag styled with the color and the range values
        // of that class and include a label with the low and a high ends of that class range
        div.innerHTML +=
            `<span style="background:${color}"></span>
            <label>${(breaks[i][0]*100).toLocaleString()}&mdash;
            ${(breaks[i][1]*100).toLocaleString()}</label>`;
    }

    // return the populated div to be added to the map
    return div;
};

// add the legend to the map
legend.addTo(map);
if (L.Browser.mobile) {
  // if true use popup
  layer.bindPopup(toolTipInfo);
  } else {
  // if false use tooltip
  layer.bindTooltip(toolTipInfo, {
    sticky: true
  });
};
}
 
}

 
function getClassBreaks (dataLayer) {
// empty array to hold all our values
var values = [];

dataLayer.eachLayer(function(layer) {
  // shorthand refernce to properties (props)
  var props = layer.feature.properties

  // calculate the normalized value
  var value = props[attributeValue]/props[normValue];
// push that value to the array
values.push(value);
});

console.log(values);

var clusters = ss.ckmeans(values, 5);

// create an array of the lower values within each cluster
var breaks = clusters.map(function(cluster){
  return [cluster[0],cluster.pop()];
});
return breaks; // return Array of your break values
} // end getClassBreaks function

/* --------------- Toggle on/off info footer content ---------------  */
var clicked = false // start with false condition
function myInfo() {

    // create button that changes color on click
    // create a footer overlay that displays 33% of the current viewport height
    var x = document.getElementById('footer');
    var y = document.getElementById('info-button');
    if (clicked) {
        y.style.background = 'rgba(100, 100, 100, 0.9)'; // gray button
        x.style.height = '0px'; // no footer height 
    } else {
        y.style.background = 'rgba(146, 239, 146, 0.8)' // green button
        x.style.height = '33vh';  // footer 33% of viewport height
    }
    clicked = !clicked

}

	</script>

</body>

</html>